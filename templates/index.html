<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>KRISHNA X FEAR ‚Ä¢ KeyAuth Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root{
        --bg1:#25345f; --bg2:#0b0f1d; --card:#0a0f1c;
        --accent:#4cc9ff; --accent2:#9560ff; --muted:#7d8fb3;
        --glass-border:rgba(120,180,255,.35);
    }
    html,body{height:100%;margin:0;font-family:'Inter',sans-serif;background:radial-gradient(circle at top,var(--bg1) 0%,var(--bg2) 60%,#03040b 100%);color:#e9f5ff}
    /* common container */
    .app-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;gap:22px;position:relative}
    /* global title */
    .global-title-bar{position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:80;pointer-events:none}
    .global-title{pointer-events:auto;font-family:'Orbitron',sans-serif;text-transform:uppercase;letter-spacing:.25em;font-size:1rem;padding:6px 20px;border-radius:999px;background:radial-gradient(circle at top,rgba(76,201,255,0.18),rgba(5,10,25,0.9));border:1px solid rgba(122,187,255,0.45);color:#e9f5ff;text-shadow:0 0 8px rgba(76,201,255,0.9);box-shadow:0 0 22px rgba(0,0,0,.9)}
    /* glass card */
    .glass-card{width:420px;max-width:calc(100% - 40px);background:linear-gradient(180deg,rgba(6,10,25,0.95),rgba(2,6,23,0.95));border-radius:14px;padding:18px;border:1px solid var(--glass-border);box-shadow:0 20px 50px rgba(0,0,0,.85);backdrop-filter:blur(6px)}
    /* login */
    .login-card{display:flex;flex-direction:column;gap:10px}
    .login-brand{display:flex;justify-content:space-between;align-items:center}
    .login-title{font-family:'Orbitron',sans-serif;text-transform:uppercase;letter-spacing:.16em;font-size:.85rem}
    .login-title .krishna{color:var(--accent)} .login-title .fear{color:#ff6bcb} .login-title .auth{color:#d9e7ff}
    .login-sub{font-size:.74rem;color:var(--muted)}
    .pill{padding:4px 10px;border-radius:999px;font-size:.72rem;border:1px solid rgba(148,163,255,.6);color:#c7d2ff;background:rgba(15,23,42,0.9)}
    .field-label{font-size:.78rem;color:#9eb3d8;margin-top:8px}
    .login-input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(124,152,230,.7);background:rgba(2,6,23,.92);color:#e9f5ff;font-size:0.95rem;outline:none}
    .login-input:focus{border-color:var(--accent);box-shadow:0 0 6px rgba(76,201,255,.25)}
    .login-btn{width:100%;padding:10px;border-radius:999px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#020617;font-weight:700;cursor:pointer;margin-top:8px}
    .login-footer{display:flex;justify-content:space-between;font-size:.75rem;color:#8993a8;margin-top:8px}
    .error{color:#ff6b81;font-size:.85rem}
    /* panel styles */
    .container{display:flex;flex-direction:column;gap:16px}
    .auth-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .brand-title{font-family:'Orbitron',sans-serif;letter-spacing:.16em;text-transform:uppercase;font-size:0.9rem;color:#9fd5ff}
    .brand-sub{font-size:.72rem;color:var(--muted)}
    .status-pill{padding:4px 10px;border-radius:999px;font-size:0.72rem;text-transform:uppercase;border:1px solid rgba(77,255,136,.7);color:#4dff88;background:rgba(5,26,18,.85)}
    h1,h2{margin:6px 0}
    .subtitle{color:var(--muted);font-size:.9rem;margin-bottom:8px}
    .form-group{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .form-group input[type=text], .form-group input[type=number]{flex:1;min-width:120px;padding:10px;border-radius:8px;border:1px solid rgba(116,154,230,.5);background:rgba(3,7,20,.9);color:#e9f5ff}
    .hwid-toggle{font-size:.85rem;color:var(--muted);display:inline-flex;align-items:center;gap:6px}
    .gen-btn{padding:10px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,#4cc9ff,#9560ff);color:#020617;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
    .key-result{margin-top:12px;padding:10px;border-radius:8px;background:rgba(5,8,18,.5);border:1px solid rgba(120,180,255,.12)}
    .key-display{display:flex;align-items:center;gap:8px}
    .copy-btn{border:none;background:rgba(4,12,30,.9);border:1px solid rgba(116,154,230,.5);padding:6px;border-radius:8px;color:var(--accent);cursor:pointer}
    .key-info{margin-top:6px;color:var(--muted);font-size:.85rem}
    .key-history{margin-top:8px}
    .key-history-title{font-size:.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:.12em;margin-bottom:6px}
    .key-history-list{max-height:90px;overflow-y:auto}
    .key-history-item{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:4px 0}
    /* table */
    .table-card{padding:12px}
    .table-container{overflow:auto}
    table{width:100%;border-collapse:collapse;color:#e9f5ff}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.03);font-size:0.85rem;text-align:left}
    th{background:rgba(76,201,255,.08)}
    .status-badge{padding:2px 6px;border-radius:4px;font-size:.7rem}
    .status-active{background:rgba(77,255,136,.2);color:#4dff88;border:1px solid rgba(77,255,136,.3)}
    .status-expired{background:rgba(255,107,107,.2);color:#ff6b6b;border:1px solid rgba(255,107,107,.3)}
    .status-banned{background:rgba(255,184,107,.2);color:#ffb86b;border:1px solid rgba(255,184,107,.3)}
    .loading{text-align:center;color:var(--muted)}
    .del-btn{background:none;border:none;color:#ff7b7b;cursor:pointer;font-size:.85rem}
    .reset-btn{background:none;border:none;color:#ffaa00;cursor:pointer;font-size:.85rem;margin-left:8px}
    /* footer */
    .footer-terms{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);font-size:.75rem;color:var(--muted)}
    /* hide panel initially */
    #panelWrap{display:none}
    .hidden{display:none}
    /* status message */
    .status{position:relative;margin-top:8px;padding:8px;border-radius:8px;font-size:.9rem}
    .status.success{background:rgba(17,68,25,.5);border:1px solid rgba(77,255,136,.12);color:#bff7d0}
    .status.error{background:rgba(80,10,10,.45);border:1px solid rgba(255,100,100,.12);color:#ffd6d6}
    @media (min-width:980px){.app-wrap{gap:32px}}
</style>
</head>
<body>

<div class="global-title-bar"><div class="global-title"><span class="accent">FEAR X CORPORATION</span> PANEL</div></div>

<div class="app-wrap">

    <!-- LOGIN CARD -->
    <div class="glass-card login-card" id="loginWrap">
        <div class="login-brand">
            <div>
                <div class="login-title"><span class="krishna">KRISHNA</span> <span class="fear">X FEAR</span> <span class="auth">AUTH</span></div>
                <div class="login-sub">Owner panel login</div>
            </div>
            <div class="pill">KEYAUTH PANEL</div>
        </div>

        <div id="loginError" class="error hidden"></div>

        <div class="field-label">Username</div>
        <input id="loginUser" class="login-input" type="text" placeholder="Enter panel username">

        <div class="field-label">Password</div>
        <input id="loginPass" class="login-input" type="password" placeholder="Enter panel password">

        <button id="loginBtn" class="login-btn">Login</button>

        <div class="login-footer"><span>¬© 2025 KRISHNA X FEAR</span><a href="/">Back</a></div>
    </div>

    <!-- PANEL -->
    <div id="panelWrap" class="glass-card" aria-hidden="true">
        <div class="auth-header">
            <div>
                <div class="brand-title">KRISHNA X FEAR AUTHENTICATION</div>
                <div class="brand-sub">Secure license panel ‚Ä¢ KeyAuth</div>
            </div>
            <div style="display:flex;align-items:center;gap:10px">
                <a href="https://discord.gg/wUZYMSvUKZ" target="_blank" style="display:inline-flex;align-items:center;gap:6px;text-decoration:none;color:#9fd5ff;font-size:0.82rem">
                    <i class="fab fa-discord" style="font-size:1.1rem"></i><span>Discord</span>
                </a>
                <div class="status-pill"><i class="fas fa-shield-halved"></i> STATUS ONLINE</div>
            </div>
        </div>

        <h1><i class="fas fa-key"></i> License Console</h1>
        <p class="subtitle">Generate & manage your access keys</p>

        <div class="form-group">
            <input id="username" type="text" placeholder="Username" maxlength="20">
            <input id="days" type="number" min="1" max="365" value="7" placeholder="Days">
            <label class="hwid-toggle"><input id="hwidLock" type="checkbox"> <i class="fas fa-lock"></i> HWID Lock</label>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <button id="genBtn" class="gen-btn"><i class="fas fa-magic"></i> <span>Generate Key</span></button>
            <button id="logoutBtn" class="gen-btn" style="background:linear-gradient(90deg,#ff6b6b,#ffb86b);">Logout</button>
        </div>

        <div id="keyResult" class="key-result hidden">
            <div class="key-display">
                <span id="generatedKey" style="font-family:monospace;font-weight:700"></span>
                <button id="copyBtn" class="copy-btn"><i class="fas fa-copy"></i></button>
            </div>
            <div class="key-info">
                <span id="keyUsername"></span> | 
                <span id="keyDays"></span> | 
                <span id="keyHWID"></span>
            </div>
        </div>

        <div class="table-card" style="margin-top:12px">
            <h2><i class="fas fa-list"></i> Active Keys <span id="totalKeys" style="font-size:.85rem;color:var(--muted)">(0)</span></h2>
            <div class="table-container">
                <table id="keysTable">
                    <thead><tr><th>Key</th><th>User</th><th>Days Left</th><th>HWID</th><th>IP</th><th>Uses</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody><tr><td colspan="8" class="loading">Loading keys...</td></tr></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="footer-terms">¬© 2025 KRISHNA X FEAR</div>

<script>
/* ========== CONFIG ========== */
const BASE_URL = "https://mykeyauth.onrender.com/";
const API_HEADERS = {
    "Content-Type": "application/json",
    "X-Owner-Id": "jkl4drh6",
    "X-Secret": "ioyskcnwtdnzoexis6283niisns",  // ‚úÖ Fixed length
    "X-Api-Key": "panel_789"
};
/* ============================ */

const VALID_USER = "778899";
const VALID_PASS = "998877";

function setAuth(val){ sessionStorage.setItem("kx_auth", val ? "1":"0"); }
function isAuth(){ return sessionStorage.getItem("kx_auth")==="1"; }
function clearAuth(){ sessionStorage.removeItem("kx_auth"); }

const loginWrap = document.getElementById("loginWrap");
const panelWrap = document.getElementById("panelWrap");
const loginUser = document.getElementById("loginUser");
const loginPass = document.getElementById("loginPass");
const loginBtn = document.getElementById("loginBtn");
const loginError = document.getElementById("loginError");
const logoutBtn = document.getElementById("logoutBtn");
const genBtn = document.getElementById("genBtn");
const usernameInput = document.getElementById("username");
const daysInput = document.getElementById("days");
const hwidLockInput = document.getElementById("hwidLock");
const keyResult = document.getElementById("keyResult");
const generatedKey = document.getElementById("generatedKey");
const keyUsername = document.getElementById("keyUsername");
const keyDays = document.getElementById("keyDays");
const keyHWID = document.getElementById("keyHWID");
const copyBtn = document.getElementById("copyBtn");
const keysTableBody = document.querySelector("#keysTable tbody");
const totalKeys = document.getElementById("totalKeys");

let keysData = {};

/* ===== Protection ===== */
document.addEventListener("contextmenu", e => e.preventDefault());
document.onkeydown = function(e){
    if(e.keyCode===123 || (e.ctrlKey && e.shiftKey && (e.keyCode===73 || e.keyCode===74 || e.keyCode===67)) || (e.ctrlKey && e.keyCode===85)) return false;
};

/* ===== View control ===== */
function showPanel(){ loginWrap.style.display = "none"; panelWrap.style.display = "block"; panelWrap.removeAttribute("aria-hidden"); setAuth(true); loadKeys(); }
function showLogin(){ loginWrap.style.display = "block"; panelWrap.style.display = "none"; panelWrap.setAttribute("aria-hidden","true"); clearAuth(); }

if(isAuth()) showPanel(); else showLogin();

/* ===== Login ===== */
loginBtn.addEventListener("click", (e)=>{
    e.preventDefault();
    loginError.classList.add("hidden");
    const user = String(loginUser.value || "").trim();
    const pass = String(loginPass.value || "").trim();
    if(!user || !pass){ loginError.textContent="Enter username & password"; loginError.classList.remove("hidden"); return; }
    if(user === VALID_USER && pass === VALID_PASS){
        loginUser.value = ""; loginPass.value = "";
        showPanel();
    } else {
        loginError.textContent = "Invalid credentials"; loginError.classList.remove("hidden");
    }
});

logoutBtn.addEventListener("click", ()=> showLogin());

/* ===== Status ===== */
function showStatus(msg, type="success"){
    const s = document.createElement("div");
    s.className = `status ${type}`;
    s.textContent = msg;
    panelWrap.appendChild(s);
    setTimeout(()=>s.remove(), 3000);
}

async function api_call(endpoint, options = {}){
    if(!isAuth()) throw new Error("Not authenticated");
    const resp = await fetch(BASE_URL + endpoint, { 
        ...options, 
        headers: { ...API_HEADERS, ...options.headers }
    });
    return resp.json();
}

/* ===== Generate Key ===== */
genBtn.addEventListener("click", async ()=>{
    if(!isAuth()) return showStatus("Please login first", "error");
    const name = (usernameInput.value || "User").trim();
    const days = parseInt(daysInput.value) || 7;
    const hwid = !!hwidLockInput.checked;
    
    genBtn.disabled = true;
    genBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
    
    try{
        const data = await api_call("/generate", {
            method: "POST",
            body: JSON.stringify({ username: name, days, hwid_lock: hwid })
        });
        if(data.success && data.key){
            generatedKey.textContent = data.key;
            keyUsername.textContent = data.data.username;
            keyDays.textContent = `${data.data.days} days`;
            keyHWID.textContent = data.data.hwid ? data.data.hwid.slice(0,8)+"..." : "None";
            keyResult.classList.remove("hidden");
            showStatus(`‚úÖ Key generated for ${data.data.days} days!`, "success");
            loadKeys();
        } else {
            showStatus("‚ùå " + (data.message || "Generation failed"), "error");
        }
    }catch(err){
        showStatus("‚ùå Network error", "error");
    } finally {
        genBtn.disabled = false;
        genBtn.innerHTML = '<i class="fas fa-magic"></i> <span>Generate Key</span>';
    }
});

copyBtn.addEventListener("click", async ()=>{
    const k = generatedKey.textContent;
    if(k) {
        await navigator.clipboard.writeText(k);
        showStatus("‚úÖ Key copied!", "success");
    }
});

/* ===== Keys Table ===== */
async function loadKeys(){
    if(!isAuth()) return;
    try{
        const json = await api_call("/keys");
        if(json.success){
            keysData = json.keys || {};
            totalKeys.textContent = `(${json.total || 0})`;
            updateTable();
        }
    }catch(err){
        keysTableBody.innerHTML = '<tr><td colspan="8" class="loading">Error loading keys</td></tr>';
    }
}

function updateTable(){
    keysTableBody.innerHTML = "";
    if(Object.keys(keysData).length === 0){
        keysTableBody.innerHTML = '<tr><td colspan="8" class="loading">No keys found</td></tr>';
        return;
    }
    
    Object.entries(keysData).forEach(([key, data])=>{
        const tr = document.createElement("tr");
        const statusClass = data.banned ? "status-banned" : (data.days_left === 0 ? "status-expired" : "status-active");
        const hwid = data.hwid || data.last_hwid || "None";
        const ip = data.last_ip || "None";
        
        tr.innerHTML = `
            <td style="font-family:monospace">${key.slice(0,8)}...</td>
            <td>${data.username || '-'}</td>
            <td>${data.days_left || 0}</td>
            <td title="${hwid}">${hwid.slice ? hwid.slice(0,8)+"..." : hwid}</td>
            <td title="${ip}">${ip.slice ? ip.slice(0,12)+"..." : ip}</td>
            <td>${data.uses || 0}/${data.max_uses || '‚àû'}</td>
            <td><span class="status-badge ${statusClass}">${data.banned ? 'BANNED' : (data.days_left === 0 ? 'EXPIRED' : 'ACTIVE')}</span></td>
            <td>
                <button class="del-btn" title="Delete"><i class="fas fa-trash"></i></button>
                <button class="reset-btn" title="Reset HWID"><i class="fas fa-unlock"></i></button>
            </td>
        `;
        
        // Delete
        tr.querySelector(".del-btn").addEventListener("click", async ()=>{
            if(confirm("Delete this key?")) {
                try{
                    const resp = await api_call("/delete", { method: "POST", body: JSON.stringify({key}) });
                    if(resp.success) {
                        showStatus("üóëÔ∏è Key deleted", "success");
                        loadKeys();
                    }
                }catch(e){
                    showStatus("‚ùå Delete failed", "error");
                }
            }
        });
        
        // Reset HWID
        tr.querySelector(".reset-btn").addEventListener("click", async ()=>{
            try{
                const resp = await api_call("/reset_hwid", { method: "POST", body: JSON.stringify({key}) });
                if(resp.success) {
                    showStatus("üîì HWID reset", "success");
                    loadKeys();
                }
            }catch(e){
                showStatus("‚ùå Reset failed", "error");
            }
        });
        
        keysTableBody.appendChild(tr);
    });
}

/* Auto refresh */
setInterval(()=> isAuth() && loadKeys(), 5000);

loadKeys();
</script>
</body>
</html>
